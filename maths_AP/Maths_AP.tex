\documentclass{article}

\usepackage{fullpage}
\usepackage{graphics}
\usepackage{amsmath}
\usepackage{indentfirst}
\usepackage{setspace}
\usepackage[]{algorithm2e}

\DeclareMathOperator{\var}{var}
\DeclareMathOperator{\cov}{cov}
\newcommand{\bm}[1]{\mbox{\boldmath $ #1 $}}
\newcommand{\EE}{\mathrm{I\!E\!}}
\newcommand{\RR}{\mathrm{I\!R\!}}
\parindent=0in

\doublespacing
\pagenumbering{arabic}

\begin{document}

\title{Generalised-Pareto distribution with Predictive Processes -- MCMC updates}
\author{Andrew C. Parnell}
\maketitle

\section*{Algorithm details}

(Example below -- to be filled in):

\RestyleAlgo{boxruled}
\begin{algorithm}[H]
 \KwData{Target variables $y$ (length $n$; standardised), feature matrix $X$ ($n$ rows and $p$ columns}
 \KwResult{Posterior list of trees $T$, values of $\tau$, fitted values $\hat{y}$}
 \textbf{Initialisation\;}
 	Hyper-parameter values of $\alpha$, $\beta$, $\tau_\mu$, $\nu$, $\lambda$\;
	Number of trees $M$\;
	Number of iterations $N$\;
	Initial value $\tau = 1$\;
	Set trees $T_j$; $j=1, \ldots, M$ to stumps\;
	Set values of $\mu$ to 0\;
\For{iterations $i$ from 1 to $N$}{
	\For{trees $j$ from 1 to $M$}{
		Compute partial residuals from $y$ minus predictions of all trees except tree $j$\;
		Grow a new tree $T_j^{new}$ based on grow/prune/change/swap\;
		Set $l_{new}$ = log full conditional of new tree $T^{new}_j$ based on Equation 1 plus Equation 4\;
		Set $l_{old}$ = log full conditional of old tree $T_j$ based on same equations\;
		Set $a = \exp(l_{new} - l_{old} )$\;
		Generate $u \sim U(0, 1)$\;
		\If{$a > u$}{
			Set $T_j = T_j^{new}$\;
		}
		Simulate $\mu$ values using Equation 3\;
	}
	
	Get predictions $\hat{y}$ from all trees\;
	Update $\tau$ using Equation 4\;
}
\caption{BART Markov chain Monte Carlo}
\end{algorithm}

\section{DAG}

To be filled in

\section{Notation}

\begin{itemize}
\item $x_i$ Multivariate (bivariate or tri-variate) location values for location $i$, $i = 1,\ldots, n$. Write the matrix of all locations as just $x$
\item $y_{ij}$ Excess $j$ for observation $i$, $j = 1,\ldots,n_i$ where $n_i$ is the number of excesses at location $i$
\item $\sigma(x_i)$ Scale parameter for location $x_i$
\item $\xi(x_i)$ Shape parameter for observation $x_i$
\item $z_k$ Sub-grid locations $k = 1, \ldots, m$. Together written as $z$
\item $A, B$ Projection matrices of dimension $n \times m$
\item $\tilde{\sigma}, \tilde{\xi}$ Gaussian processes defined on sub-grid $z$
\item $\mu(z), \kappa(z)$ Means for the Gaussian processes
\item $\Sigma, \Psi$ Auto-covariance matrices for the Gaussian processes
\item $\omega_\sigma, \omega_\xi$ Nugget standard deviation parameters
\item $\alpha_\sigma, \alpha_\xi, \beta_\sigma, \beta_\xi$ intercept and slope parameters for Gaussian process means
\item $\nu_\sigma, \nu_\xi$ Matern smoothness parameters (perhaps fixed?)
\item $\rho_\sigma, \rho_\xi$ Matern scale parameters given discrete uniform prior for simplicity
\item $\tau_\sigma, \tau_\rho$ Variance parameters for Gaussian process
\end{itemize}

\section{Model outline}

In hierarchical notation:
\begin{align*}
y_{ij} &\sim GPD(\sigma(x_i), \xi(x_i)) \\
\log (\sigma (x)) &= A(x, z)^T \Sigma^{-1}(z,z) \tilde{\sigma}(z) \\
\log (\xi (x)) &= B(x, z)^T \Psi^{-1}(z,z) \tilde{\xi}(z) \\
A(x_i, z_k) &= \tau_\sigma^2 \frac{2^{1-\nu_\sigma}}{\Gamma(\nu_\sigma)}\Bigg(\sqrt{2\nu_\sigma}\frac{\|x_i - z_k\|}{\rho_\sigma}\Bigg)^{\nu_\sigma} K_{\nu_\sigma}\Bigg(\sqrt{2\nu_\sigma}\frac{\|x_i - z_k\|}{\rho_\sigma}\Bigg)\\
B(x_i, z_k) &= \tau_\xi^2 \frac{2^{1-\nu_\xi}}{\Gamma(\nu_\xi)}\Bigg(\sqrt{2\nu_\xi}\frac{\|x_i - z_k\|}{\rho_\xi}\Bigg)^{\nu_\xi} K_{\nu_\xi}\Bigg(\sqrt{2\nu_\xi}\frac{\|x_i - z_k\|}{\rho_\xi}\Bigg)\\
\tilde{\sigma} &\sim MVN_m(\mu(z), \omega_\sigma^2 I_m + \Sigma(z, z))\\
\tilde{\xi} &\sim MVN_m(\kappa(z), \omega_\xi^2 I_m + \Psi(z, z))\\
\mu(z) &= \alpha_\sigma + \beta_\sigma ^T z\\
\kappa(z) &= \alpha_\xi + \beta_\xi ^T z\\
\Sigma(z_k, z_l) &= \tau_\sigma^2 \frac{2^{1-\nu_\sigma}}{\Gamma(\nu_\sigma)}\Bigg(\sqrt{2\nu_\sigma}\frac{\|z_k - z_l\|}{\rho_\sigma}\Bigg)^{\nu_\sigma} K_{\nu_\sigma}\Bigg(\sqrt{2\nu_\sigma}\frac{\|z_k - z_l\|}{\rho_\sigma}\Bigg)\\
\Psi(z_k, z_l) &= \tau_\xi^2 \frac{2^{1-\nu_\xi}}{\Gamma(\nu_\xi)}\Bigg(\sqrt{2\nu_\xi}\frac{\|z_k - z_l\|}{\rho_\xi}\Bigg)^{\nu_\xi} K_{\nu_\xi}\Bigg(\sqrt{2\nu_\xi}\frac{\|z_k - z_l\|}{\rho_\xi}\Bigg)
\end{align*}

Hyper-parameter prior distributions (subject to change):
\begin{align*}
\tau_\sigma, \tau_\xi, \omega_\sigma, \omega_\xi &\sim U(0, 100) \\
\rho_\sigma, \rho_\xi &\sim DU(0.001, 0.01, 0.1, 1, 10, 100, 1000)\\
\alpha_\sigma, \alpha_\xi, \beta_\sigma, \beta_\xi &\sim N(0, 100)\\
\end{align*}

\section{Posterior distribution}

The full posterior distribution is:
\begin{align*}
p(\tau_\xi, \omega_\sigma, \omega_\xi, \rho_\sigma, \rho_\xi, \alpha_\sigma, \alpha_\xi, \beta_\sigma, \beta_\xi, \tilde{\sigma}, \tilde{\xi} | y, x, z, \nu_\sigma, \nu_\xi) \propto &\left[ \prod_{i=1}^n \prod_{j=1}^m p(y_{ij} | \sigma(x_i), \xi(x_i)) \right] p(\tilde{\sigma}(x) | \mu, \omega_\sigma, \Sigma) \times \\
& p(\tilde{\xi}(x) | \kappa, \omega_\xi, \Psi) p(\alpha_\sigma, \alpha_\xi, \beta_\sigma, \beta_\xi) p(\rho_\sigma, \rho_\xi) p(\tau_\sigma, \tau_\xi, \omega_\sigma, \omega_\xi)
\end{align*}

\end{document}


